(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[815],{4625:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/[slug]",function(){return t(6969)}])},8965:function(e,n,t){"use strict";t.d(n,{Z:function(){return u}});var r=t(5893),s=t(1664),i=t(7294),c=t(9863);function u(e){return(0,i.useContext)(c.S).username?e.children:e.fallback||(0,r.jsx)(s.default,{href:"/enter",children:"You must be signed in"})}},6494:function(e,n,t){"use strict";t.d(n,{Z:function(){return s}});var r=t(5893);function s(e){return e.show?(0,r.jsx)("div",{className:"loader"}):null}},6969:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return N}});var r=t(5666),s=t.n(r),i=t(5893),c=t(4850),u=t.n(c),a=t(8965),o=t(8773),l=t(7294),d=t(6494);function f(e,n,t,r,s,i,c){try{var u=e[i](c),a=u.value}catch(o){return void t(o)}u.done?n(a):Promise.resolve(a).then(r,s)}function h(){var e,n=(0,l.useState)(!1),t=n[0],r=n[1],c=(0,l.useState)(0),u=c[0],a=c[1],h=(0,l.useState)(null),p=h[0],x=h[1],m=(e=s().mark((function e(n){var t,i,c,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Array.from(n.target.files)[0],i=t.type.split("/")[1],c=o.tO.ref("uploads/".concat(o.I8.currentUser.uid,"/").concat(Date.now(),".").concat(i)),r(!0),(u=c.put(t)).on(o.mC,(function(e){var n=(e.bytesTransferred/e.totalBytes*100).toFixed(0);a(n)})),u.then((function(e){return c.getDownloadURL()})).then((function(e){x(e),r(!1)}));case 7:case"end":return e.stop()}}),e)})),function(){var n=this,t=arguments;return new Promise((function(r,s){var i=e.apply(n,t);function c(e){f(i,r,s,c,u,"next",e)}function u(e){f(i,r,s,c,u,"throw",e)}c(void 0)}))});return(0,i.jsxs)("div",{className:"box",children:[(0,i.jsx)(d.Z,{show:t}),t&&(0,i.jsxs)("h3",{children:[u,"%"]}),!t&&(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("label",{className:"btn",children:["\ud83d\udcf8 Upload Img",(0,i.jsx)("input",{type:"file",onChange:m,accept:"image/x-png,image/gif,image/jpeg"})]})}),p&&(0,i.jsx)("code",{className:"upload-snippet",children:"![alt](".concat(p,")")})]})}t(5503);var p=t(1163),x=t(6677),m=t(2283),v=t(724),j=t.n(v),b=t(1664),g=t(4931);function w(e,n,t,r,s,i,c){try{var u=e[i](c),a=u.value}catch(o){return void t(o)}u.done?n(a):Promise.resolve(a).then(r,s)}function _(e){return function(){var n=this,t=arguments;return new Promise((function(r,s){var i=e.apply(n,t);function c(e){w(i,r,s,c,u,"next",e)}function u(e){w(i,r,s,c,u,"throw",e)}c(void 0)}))}}function y(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=[],r=!0,s=!1,i=void 0;try{for(var c,u=e[Symbol.iterator]();!(r=(c=u.next()).done)&&(t.push(c.value),!n||t.length!==n);r=!0);}catch(a){s=!0,i=a}finally{try{r||null==u.return||u.return()}finally{if(s)throw i}}return t}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function N(e){return(0,i.jsx)(a.Z,{children:(0,i.jsx)(k,{})})}function k(){var e=(0,l.useState)(!1),n=e[0],t=e[1],r=(0,p.useRouter)().query.slug,s=o.RZ.collection("users").doc(o.I8.currentUser.uid).collection("posts").doc(r),c=y((0,x.Xi)(s),1)[0];return(0,i.jsx)("main",{className:u().container,children:c&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("section",{children:[(0,i.jsx)("h1",{children:c.title}),(0,i.jsxs)("p",{children:["ID: ",c.slug]}),(0,i.jsx)(S,{postRef:s,defaultValues:c,preview:n})]}),(0,i.jsxs)("aside",{children:[(0,i.jsx)("h3",{children:"Tools"}),(0,i.jsx)("button",{onClick:function(){return t(!n)},children:n?"Edit":"Preview"}),(0,i.jsx)(b.default,{href:"/".concat(c.username,"/").concat(c.slug),children:(0,i.jsx)("button",{className:"btn-blue",children:"Live view"})}),(0,i.jsx)(P,{postRef:s})]})]})})}function S(e){var n=e.defaultValues,t=e.postRef,r=e.preview,c=(0,m.cI)({defaultValues:n,mode:"onChange"}),a=c.register,d=c.errors,f=c.handleSubmit,p=c.formState,x=c.reset,v=c.watch,b=p.isValid,w=p.isDirty,y=(0,l.useState)(n.existing),N=(y[0],y[1]),k=(0,l.useState)(n.potential),S=(k[0],k[1]),P=(0,l.useState)({potential:[{amount:0,contactNumber:"",name:""}]}),R=(P[0],P[1],(0,l.useRef)(null),(0,l.useRef)(null),(0,l.useRef)(null),_(s().mark((function e(n){var r=n.content,i=n.published;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.update({content:r,published:i,updatedAt:(0,o.Bt)()});case 2:x({content:r,published:i}),g.ZP.success("Post updated successfully!");case 4:case"end":return e.stop()}}),e)}))));return(0,l.useEffect)((function(){S(n.potential),N(n.existing)})),(0,i.jsxs)("form",{onSubmit:f(R),children:[r&&(0,i.jsx)("div",{className:"card",children:(0,i.jsx)(j(),{children:v("content")})}),(0,i.jsxs)("div",{className:r?u().hidden:u().controls,children:[(0,i.jsx)(h,{}),(0,i.jsx)("textarea",{name:"content",ref:a({maxLength:{value:2e4,message:"content is too long"},minLength:{value:10,message:"content is too short"},required:{value:!0,message:"content is required"}})}),d.content&&(0,i.jsx)("p",{className:"text-danger",children:d.content.message}),(0,i.jsxs)("fieldset",{children:[(0,i.jsx)("input",{className:u().checkbox,name:"published",type:"checkbox",ref:a}),(0,i.jsx)("label",{children:"Published"})]}),(0,i.jsx)("button",{type:"submit",className:"btn-green",disabled:!w||!b,children:"Save Changes"})]})]})}function P(e){var n=e.postRef,t=(0,p.useRouter)(),r=_(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!confirm("are you sure!")){e.next=6;break}return e.next=4,n.delete();case 4:t.push("/admin"),(0,g.ZP)("post annihilated ",{icon:"\ud83d\uddd1\ufe0f"});case 6:case"end":return e.stop()}}),e)})));return(0,i.jsx)("button",{className:"btn-red",onClick:r,children:"Delete"})}},4850:function(e){e.exports={container:"Admin_container__3gjyU",hidden:"Admin_hidden__1KXRX",controls:"Admin_controls__1pv-o",input:"Admin_input__xQFe-",checkbox:"Admin_checkbox__G0v5P"}}},function(e){e.O(0,[774,963,283,888,179],(function(){return n=4625,e(e.s=n);var n}));var n=e.O();_N_E=n}]);